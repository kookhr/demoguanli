<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è·¯ç”±æµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }
        .button {
            background: #2563eb;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 10px;
            font-size: 16px;
            display: block;
            width: 100%;
        }
        .button:hover {
            background: #1d4ed8;
        }
        .result {
            margin-top: 20px;
            padding: 20px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 14px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .result.success {
            background: #ecfdf5;
            border: 1px solid #10b981;
            color: #065f46;
        }
        .result.error {
            background: #fef2f2;
            border: 1px solid #ef4444;
            color: #991b1b;
        }
        .result.info {
            background: #eff6ff;
            border: 1px solid #3b82f6;
            color: #1e40af;
        }
        .link-test {
            margin: 10px 0;
            padding: 10px;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
        }
        .link-test a {
            color: #2563eb;
            text-decoration: none;
            font-weight: bold;
        }
        .link-test a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”„ å…¨é¢è·¯ç”±è¯Šæ–­å·¥å…·</h1>
            <p>è¯Šæ–­å’Œä¿®å¤ç½‘ç«™è·¯ç”±é…ç½®é—®é¢˜</p>
        </div>

        <button class="button" onclick="testRouting()">ğŸš€ å®Œæ•´è·¯ç”±æµ‹è¯•</button>
        <button class="button" onclick="testResourceLoading()">ğŸ“¦ èµ„æºåŠ è½½æµ‹è¯•</button>
        <button class="button" onclick="testRedirectLoop()">ğŸ”„ é‡å®šå‘å¾ªç¯æ£€æµ‹</button>
        
        <div class="link-test">
            <strong>æ‰‹åŠ¨æµ‹è¯•é“¾æ¥ï¼š</strong><br>
            <a href="/" target="_blank">æ ¹ç›®å½• (/) - åº”è¯¥åŠ è½½ dist/index.html</a><br>
            <a href="/dist/index.html" target="_blank">ç›´æ¥è®¿é—® dist/index.html</a><br>
            <a href="/index.html" target="_blank">æ ¹ç›®å½• index.html (å¼€å‘ç‰ˆæœ¬)</a><br>
            <a href="/api/health" target="_blank">APIå¥åº·æ£€æŸ¥</a>
        </div>
        
        <div id="result" class="result" style="display: none;"></div>
    </div>

    <script>
        function showResult(content, type = 'info') {
            const element = document.getElementById('result');
            element.style.display = 'block';
            element.className = `result ${type}`;
            element.textContent = typeof content === 'object' ? JSON.stringify(content, null, 2) : content;
        }

        // æ–°å¢ï¼šèµ„æºåŠ è½½æµ‹è¯•
        async function testResourceLoading() {
            showResult('æ­£åœ¨æµ‹è¯•èµ„æºåŠ è½½...', 'info');

            let report = 'ğŸ“¦ èµ„æºåŠ è½½æµ‹è¯•æŠ¥å‘Š\n';
            report += '=' .repeat(50) + '\n\n';

            // æµ‹è¯•å…³é”®èµ„æºæ–‡ä»¶
            const resources = [
                { path: '/dist/assets/index-CmRkGmP_.js', type: 'JavaScript', expected: 'application/javascript' },
                { path: '/dist/assets/index-CmQAOyIr.css', type: 'CSS', expected: 'text/css' },
                { path: '/dist/K.svg', type: 'SVG', expected: 'image/svg+xml' },
                { path: '/src/main.jsx', type: 'JSXæºæ–‡ä»¶', expected: 'application/javascript' },
                { path: '/api/health', type: 'APIç«¯ç‚¹', expected: 'application/json' }
            ];

            report += '1ï¸âƒ£ å…³é”®èµ„æºæ£€æŸ¥:\n';

            for (const resource of resources) {
                try {
                    const response = await fetch(resource.path, { method: 'HEAD' });
                    const contentType = response.headers.get('content-type');

                    if (response.ok) {
                        if (contentType && contentType.includes(resource.expected.split('/')[1])) {
                            report += `   âœ… ${resource.type}: ${resource.path} (${contentType})\n`;
                        } else {
                            report += `   âŒ ${resource.type}: ${resource.path} - é”™è¯¯MIMEç±»å‹: ${contentType}\n`;
                        }
                    } else {
                        report += `   âŒ ${resource.type}: ${resource.path} - HTTP ${response.status}\n`;
                    }
                } catch (error) {
                    report += `   âŒ ${resource.type}: ${resource.path} - è¿æ¥é”™è¯¯\n`;
                }
            }

            report += '\n2ï¸âƒ£ èµ„æºåŠ è½½å»ºè®®:\n';
            report += '   â€¢ å¦‚æœJavaScriptæ–‡ä»¶MIMEç±»å‹é”™è¯¯ï¼Œæ£€æŸ¥.htaccessé…ç½®\n';
            report += '   â€¢ å¦‚æœèµ„æº404ï¼Œæ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨å’Œè·¯å¾„æ˜¯å¦æ­£ç¡®\n';
            report += '   â€¢ å¦‚æœAPIç«¯ç‚¹å¤±è´¥ï¼Œæ£€æŸ¥PHPé…ç½®\n';

            showResult(report, 'info');
        }

        // æ–°å¢ï¼šé‡å®šå‘å¾ªç¯æ£€æµ‹
        async function testRedirectLoop() {
            showResult('æ­£åœ¨æ£€æµ‹é‡å®šå‘å¾ªç¯...', 'info');

            let report = 'ğŸ”„ é‡å®šå‘å¾ªç¯æ£€æµ‹æŠ¥å‘Š\n';
            report += '=' .repeat(50) + '\n\n';

            const testPaths = ['/', '/dist/index.html', '/some-spa-route'];

            for (const path of testPaths) {
                try {
                    const response = await fetch(path, {
                        method: 'GET',
                        redirect: 'manual'  // ä¸è‡ªåŠ¨è·Ÿéšé‡å®šå‘
                    });

                    if (response.status >= 300 && response.status < 400) {
                        const location = response.headers.get('location');
                        report += `   ğŸ”„ ${path}: é‡å®šå‘åˆ° ${location} (${response.status})\n`;

                        // æ£€æŸ¥æ˜¯å¦æ˜¯å¾ªç¯é‡å®šå‘
                        if (location === path) {
                            report += `   âŒ æ£€æµ‹åˆ°å¾ªç¯é‡å®šå‘: ${path} â†’ ${location}\n`;
                        }
                    } else if (response.ok) {
                        report += `   âœ… ${path}: æ­£å¸¸å“åº” (${response.status})\n`;
                    } else {
                        report += `   âŒ ${path}: é”™è¯¯å“åº” (${response.status})\n`;
                    }
                } catch (error) {
                    report += `   âŒ ${path}: æ£€æµ‹å¤±è´¥ - ${error.message}\n`;
                }
            }

            report += '\nğŸ’¡ ä¿®å¤å»ºè®®:\n';
            report += '   â€¢ å¦‚æœæ£€æµ‹åˆ°å¾ªç¯é‡å®šå‘ï¼Œæ£€æŸ¥.htaccessé‡å†™è§„åˆ™\n';
            report += '   â€¢ ç¡®ä¿é‡å®šå‘ç›®æ ‡è·¯å¾„æ­£ç¡®ä¸”å¯è®¿é—®\n';
            report += '   â€¢ ä½¿ç”¨302é‡å®šå‘è€Œä¸æ˜¯å†…éƒ¨é‡å†™é¿å…å¾ªç¯\n';

            showResult(report, 'info');
        }

        async function testRouting() {
            showResult('æ­£åœ¨è¿›è¡Œå®Œæ•´è·¯ç”±æµ‹è¯•...', 'info');

            let report = 'ğŸ”„ å®Œæ•´è·¯ç”±é…ç½®æµ‹è¯•æŠ¥å‘Š\n';
            report += '=' .repeat(50) + '\n\n';
            
            // 1. æ£€æµ‹å½“å‰é¡µé¢ç¯å¢ƒ
            report += '1ï¸âƒ£ å½“å‰é¡µé¢ç¯å¢ƒæ£€æµ‹:\n';
            report += `   å½“å‰URL: ${window.location.href}\n`;
            
            // æ£€æŸ¥é¡µé¢èµ„æº
            const scripts = document.querySelectorAll('script[src]');
            const stylesheets = document.querySelectorAll('link[rel="stylesheet"]');
            
            let isProduction = false;
            let isDevelopment = false;
            
            scripts.forEach(script => {
                if (script.src.includes('/src/') || script.src.includes('main.jsx')) {
                    isDevelopment = true;
                    report += `   âŒ æ£€æµ‹åˆ°å¼€å‘èµ„æº: ${script.src}\n`;
                } else if (script.src.includes('assets/') || script.src.includes('/dist/')) {
                    isProduction = true;
                    report += `   âœ… æ£€æµ‹åˆ°ç”Ÿäº§èµ„æº: ${script.src}\n`;
                }
            });
            
            if (isProduction) {
                report += '   âœ… å½“å‰ä½¿ç”¨ç”Ÿäº§ç¯å¢ƒ (æ­£ç¡®)\n';
            } else if (isDevelopment) {
                report += '   âŒ å½“å‰ä½¿ç”¨å¼€å‘ç¯å¢ƒ (è·¯ç”±é…ç½®é—®é¢˜)\n';
            } else {
                report += '   âš ï¸ æ— æ³•ç¡®å®šå½“å‰ç¯å¢ƒ\n';
            }
            
            // 2. æµ‹è¯•ä¸åŒè·¯å¾„çš„å“åº”
            report += '\n2ï¸âƒ£ è·¯å¾„å“åº”æµ‹è¯•:\n';
            
            const pathTests = [
                { path: '/', description: 'æ ¹ç›®å½•' },
                { path: '/dist/index.html', description: 'ç”Ÿäº§ç‰ˆæœ¬' },
                { path: '/index.html', description: 'å¼€å‘ç‰ˆæœ¬' },
                { path: '/api/health', description: 'APIç«¯ç‚¹' }
            ];
            
            for (const test of pathTests) {
                try {
                    const response = await fetch(test.path, { method: 'HEAD' });
                    const contentType = response.headers.get('content-type');
                    
                    if (response.ok) {
                        report += `   âœ… ${test.path}: ${response.status} (${contentType})\n`;
                    } else {
                        report += `   âŒ ${test.path}: ${response.status} ${response.statusText}\n`;
                    }
                } catch (error) {
                    report += `   âŒ ${test.path}: è¿æ¥é”™è¯¯ - ${error.message}\n`;
                }
            }
            
            // 3. æ£€æŸ¥æ–‡ä»¶å­˜åœ¨æ€§
            report += '\n3ï¸âƒ£ æ–‡ä»¶å­˜åœ¨æ€§æ£€æŸ¥:\n';
            
            const fileTests = [
                'dist/index.html',
                'dist/assets/index-CmRkGmP_.js',
                'dist/assets/index-CmQAOyIr.css'
            ];
            
            for (const file of fileTests) {
                try {
                    const response = await fetch(file, { method: 'HEAD' });
                    if (response.ok) {
                        report += `   âœ… ${file}: å­˜åœ¨\n`;
                    } else {
                        report += `   âŒ ${file}: ä¸å­˜åœ¨ (${response.status})\n`;
                    }
                } catch (error) {
                    report += `   âŒ ${file}: æ£€æŸ¥å¤±è´¥ - ${error.message}\n`;
                }
            }
            
            // 4. è·¯ç”±è¯Šæ–­
            report += '\n4ï¸âƒ£ è·¯ç”±è¯Šæ–­:\n';
            
            if (isDevelopment && !isProduction) {
                report += '   âŒ é—®é¢˜: æ ¹ç›®å½•ä»åœ¨ä½¿ç”¨å¼€å‘ç‰ˆæœ¬\n';
                report += '   ğŸ’¡ è§£å†³æ–¹æ¡ˆ:\n';
                report += '     1. æ£€æŸ¥ .htaccess é…ç½®æ˜¯å¦ç”Ÿæ•ˆ\n';
                report += '     2. ç¡®è®¤ dist/index.html æ–‡ä»¶å­˜åœ¨\n';
                report += '     3. éªŒè¯æœåŠ¡å™¨æ˜¯å¦æ”¯æŒ mod_rewrite\n';
                report += '     4. å°è¯•å¼ºåˆ¶åˆ·æ–°æµè§ˆå™¨ç¼“å­˜\n';
            } else if (isProduction) {
                report += '   âœ… è·¯ç”±é…ç½®æ­£å¸¸ï¼Œæ­£åœ¨ä½¿ç”¨ç”Ÿäº§ç‰ˆæœ¬\n';
            } else {
                report += '   âš ï¸ æ— æ³•ç¡®å®šè·¯ç”±çŠ¶æ€ï¼Œéœ€è¦è¿›ä¸€æ­¥æ£€æŸ¥\n';
            }
            
            // 5. å»ºè®®çš„ä¿®å¤æ­¥éª¤
            report += '\n5ï¸âƒ£ å»ºè®®çš„ä¿®å¤æ­¥éª¤:\n';
            if (isDevelopment) {
                report += '   1. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜å¹¶å¼ºåˆ¶åˆ·æ–° (Ctrl+F5)\n';
                report += '   2. æ£€æŸ¥ .htaccess æ–‡ä»¶æ˜¯å¦æ­£ç¡®ä¸Šä¼ \n';
                report += '   3. éªŒè¯ dist ç›®å½•å’Œæ–‡ä»¶æƒé™\n';
                report += '   4. è”ç³» Serv00 æŠ€æœ¯æ”¯æŒæ£€æŸ¥ mod_rewrite é…ç½®\n';
            } else {
                report += '   â€¢ è·¯ç”±é…ç½®çœ‹èµ·æ¥æ­£å¸¸\n';
                report += '   â€¢ å¦‚æœä»æœ‰é—®é¢˜ï¼Œè¯·æ£€æŸ¥å…·ä½“çš„é”™è¯¯ä¿¡æ¯\n';
            }
            
            report += `\nğŸ“… æµ‹è¯•æ—¶é—´: ${new Date().toLocaleString()}`;
            
            const resultType = isProduction ? 'success' : (isDevelopment ? 'error' : 'info');
            showResult(report, resultType);
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œæµ‹è¯•
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ”„ è·¯ç”±æµ‹è¯•é¡µé¢å·²åŠ è½½');
            
            // è‡ªåŠ¨è¿è¡Œè·¯ç”±æµ‹è¯•
            setTimeout(() => {
                testRouting();
            }, 1000);
        });
    </script>
</body>
</html>
