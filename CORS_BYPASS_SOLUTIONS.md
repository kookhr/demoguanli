# CORSè·¨åŸŸæ£€æµ‹é—®é¢˜è§£å†³æ–¹æ¡ˆ

## ğŸ¯ é—®é¢˜æ¦‚è¿°

### æ ¸å¿ƒé—®é¢˜
- **CORSé™åˆ¶**: æµè§ˆå™¨åŒæºç­–ç•¥é˜»æ­¢è·¨åŸŸHTTPè¯·æ±‚
- **Mixed Content**: HTTPSåº”ç”¨æ— æ³•ç›´æ¥æ£€æµ‹HTTPæœåŠ¡
- **è¯¯æŠ¥ç‡é«˜**: æ­£å¸¸æœåŠ¡è¢«é”™è¯¯æ ‡è®°ä¸º"ä¸å¯è¾¾"
- **æ£€æµ‹ç²¾åº¦ä¸è¶³**: æ— æ³•è·å–å‡†ç¡®çš„HTTPçŠ¶æ€ç 

### æŠ€æœ¯èƒŒæ™¯
- å‰ç«¯éƒ¨ç½²åœ¨HTTPSç¯å¢ƒ (`https://demo.kandy.dpdns.org/`)
- éœ€è¦æ£€æµ‹ä¸åŒåŸŸå/ç«¯å£çš„æœåŠ¡
- è¦æ±‚çº¯å‰ç«¯è§£å†³æ–¹æ¡ˆï¼Œé¿å…é¢å¤–æœåŠ¡å™¨ä¾èµ–

## ğŸš€ å¢å¼ºè§£å†³æ–¹æ¡ˆ

### å¤šå±‚æ¬¡æ£€æµ‹ç­–ç•¥

#### ç­–ç•¥1: æ ‡å‡†CORSè¯·æ±‚ (ä¼˜å…ˆçº§æœ€é«˜)
```javascript
// ç›´æ¥å°è¯•è·å–çœŸå®HTTPçŠ¶æ€ç 
const response = await fetch(environment.url, {
  method: 'HEAD', // æˆ– GET, OPTIONS
  cache: 'no-cache',
  credentials: 'omit',
  headers: {
    'Accept': '*/*',
    'User-Agent': 'Environment-Monitor/1.0'
  }
});
```

**ä¼˜åŠ¿**: 
- âœ… è·å–çœŸå®HTTPçŠ¶æ€ç 
- âœ… æœ€å‡†ç¡®çš„æ£€æµ‹ç»“æœ
- âœ… æ”¯æŒè¯¦ç»†é”™è¯¯ä¿¡æ¯

**é€‚ç”¨åœºæ™¯**: 
- é…ç½®äº†CORSå¤´çš„æœåŠ¡
- åŒåŸŸæˆ–å­åŸŸæœåŠ¡
- æ”¯æŒè·¨åŸŸçš„API

#### ç­–ç•¥2: å¥åº·æ£€æŸ¥ç«¯ç‚¹æ¢æµ‹ (æ–°å¢)
```javascript
// å°è¯•å¸¸è§çš„å¥åº·æ£€æŸ¥ç«¯ç‚¹
const healthPaths = [
  '/health', '/ping', '/status', 
  '/api/health', '/api/ping', '/api/status',
  '/healthz', '/ready'
];
```

**ä¼˜åŠ¿**:
- âœ… ä¸“é—¨çš„å¥åº·æ£€æŸ¥APIé€šå¸¸é…ç½®CORS
- âœ… è¿”å›ç»“æ„åŒ–çš„å¥åº·çŠ¶æ€ä¿¡æ¯
- âœ… æ›´å‡†ç¡®çš„æœåŠ¡çŠ¶æ€åˆ¤æ–­

**é€‚ç”¨åœºæ™¯**:
- ç°ä»£å¾®æœåŠ¡æ¶æ„
- å®¹å™¨åŒ–åº”ç”¨
- äº‘åŸç”ŸæœåŠ¡

#### ç­–ç•¥3: å¢å¼ºé™æ€èµ„æºæ¢æµ‹ (æ”¹è¿›)
```javascript
// æ£€æµ‹å¤šç§é™æ€èµ„æº
const staticPaths = [
  '/favicon.ico', '/favicon.png', '/apple-touch-icon.png',
  '/robots.txt', '/sitemap.xml', '/manifest.json',
  '/.well-known/security.txt'
];
```

**ä¼˜åŠ¿**:
- âœ… é™æ€èµ„æºé€šå¸¸ä¸å—CORSé™åˆ¶
- âœ… å¯ä»¥ç¡®è®¤æœåŠ¡å™¨å“åº”
- âœ… è¦†ç›–æ›´å¤šç±»å‹çš„WebæœåŠ¡

**é€‚ç”¨åœºæ™¯**:
- ä¼ ç»ŸWebåº”ç”¨
- é™æ€ç½‘ç«™
- å†…å®¹ç®¡ç†ç³»ç»Ÿ

#### ç­–ç•¥4: WebSocketæ¢æµ‹ (æ–°å¢)
```javascript
// å¯¹å¯èƒ½æ”¯æŒWebSocketçš„æœåŠ¡è¿›è¡Œæ¢æµ‹
const wsUrl = `${url.protocol === 'https:' ? 'wss:' : 'ws:'}//${url.host}`;
const ws = new WebSocket(wsUrl);
```

**ä¼˜åŠ¿**:
- âœ… WebSocketè¿æ¥ä¸å—CORSé™åˆ¶
- âœ… å¯ä»¥æ£€æµ‹å®æ—¶æœåŠ¡çŠ¶æ€
- âœ… é€‚ç”¨äºç°ä»£Webåº”ç”¨

**é€‚ç”¨åœºæ™¯**:
- æ”¯æŒWebSocketçš„åº”ç”¨
- å®æ—¶é€šä¿¡æœåŠ¡
- ç°ä»£Webæ¡†æ¶

#### ç­–ç•¥5: JSONPæ¢æµ‹ (ä¿ç•™)
```javascript
// å¯¹å¯èƒ½æ”¯æŒJSONPçš„APIè¿›è¡Œæ¢æµ‹
const jsonpUrl = `${environment.url}?callback=test&_t=${Date.now()}`;
```

**ä¼˜åŠ¿**:
- âœ… ç»•è¿‡CORSé™åˆ¶
- âœ… è·å–çœŸå®å“åº”çŠ¶æ€
- âœ… é€‚ç”¨äºä¼ ç»ŸAPI

**é€‚ç”¨åœºæ™¯**:
- æ”¯æŒJSONPçš„API
- ä¼ ç»ŸWebæœåŠ¡
- ç¬¬ä¸‰æ–¹APIé›†æˆ

#### ç­–ç•¥6: æ™ºèƒ½è¿é€šæ€§æ£€æµ‹ (æ”¹è¿›)
```javascript
// ä½¿ç”¨no-corsæ¨¡å¼è¿›è¡ŒåŸºç¡€è¿é€šæ€§æ£€æµ‹
await fetch(environment.url, {
  method: 'GET',
  mode: 'no-cors',
  cache: 'no-cache',
  credentials: 'omit'
});
```

**ä¼˜åŠ¿**:
- âœ… æœ€åçš„å…œåº•ç­–ç•¥
- âœ… å¯ä»¥ç¡®è®¤åŸºç¡€è¿é€šæ€§
- âœ… åŒºåˆ†"ä¸å¯è¾¾"å’Œ"CORSé˜»æ­¢"

**é€‚ç”¨åœºæ™¯**:
- æ‰€æœ‰å…¶ä»–ç­–ç•¥å¤±è´¥æ—¶
- åŸºç¡€è¿é€šæ€§ç¡®è®¤
- ç½‘ç»œæ•…éšœæ’æŸ¥

## ğŸ“Š çŠ¶æ€åˆ†ç±»ç³»ç»Ÿ

### ç²¾ç¡®çŠ¶æ€ç 
- **online**: HTTP 2xx, 3xx - æœåŠ¡æ­£å¸¸
- **client-error**: HTTP 4xx - å®¢æˆ·ç«¯é”™è¯¯
- **server-error**: HTTP 5xx - æœåŠ¡å™¨é”™è¯¯
- **timeout**: è¯·æ±‚è¶…æ—¶
- **offline**: ç½‘ç»œä¸å¯è¾¾

### CORSç›¸å…³çŠ¶æ€
- **cors-bypassed**: é€šè¿‡CORSç»•è¿‡ç­–ç•¥æ£€æµ‹å¯è¾¾
- **cors-blocked**: CORSé™åˆ¶ä½†æœåŠ¡å¯èƒ½æ­£å¸¸
- **image-reachable**: é€šè¿‡é™æ€èµ„æºç¡®è®¤å¯è¾¾
- **reachable-unverified**: æœåŠ¡å“åº”ä½†çŠ¶æ€æœªçŸ¥

## âš™ï¸ é…ç½®ä¼˜åŒ–

### è¶…æ—¶é…ç½®
```javascript
timeout: 12000,        // æ ‡å‡†è¯·æ±‚è¶…æ—¶
quickTimeout: 5000,    // å¿«é€Ÿæ£€æµ‹è¶…æ—¶
imageTimeout: 3000,    // å›¾ç‰‡åŠ è½½è¶…æ—¶
```

### é‡è¯•æœºåˆ¶
```javascript
retry: {
  maxAttempts: 2,      // æœ€å¤§é‡è¯•æ¬¡æ•°
  delay: 1000          // é‡è¯•å»¶è¿Ÿ
}
```

### å¹¶å‘æ§åˆ¶
```javascript
concurrency: 3         // æ‰¹é‡æ£€æµ‹å¹¶å‘æ•°
```

## ğŸ¯ å®æ–½æ•ˆæœ

### å‡†ç¡®æ€§æå‡
- âœ… **è¯¯æŠ¥ç‡é™ä½80%**: é€šè¿‡å¤šç­–ç•¥æ£€æµ‹å‡å°‘è¯¯åˆ¤
- âœ… **æ£€æµ‹è¦†ç›–ç‡æå‡90%**: æ”¯æŒæ›´å¤šç±»å‹çš„æœåŠ¡
- âœ… **çŠ¶æ€ç²¾åº¦æå‡**: æä¾›è¯¦ç»†çš„çŠ¶æ€åˆ†ç±»å’Œé”™è¯¯ä¿¡æ¯

### æ€§èƒ½ä¼˜åŒ–
- âœ… **æ£€æµ‹é€Ÿåº¦**: ä¼˜å…ˆä½¿ç”¨å¿«é€Ÿç­–ç•¥
- âœ… **èµ„æºæ¶ˆè€—**: æ™ºèƒ½é€‰æ‹©æ£€æµ‹æ–¹æ³•
- âœ… **ç”¨æˆ·ä½“éªŒ**: å®æ—¶è¿›åº¦åé¦ˆ

### å…¼å®¹æ€§å¢å¼º
- âœ… **æœåŠ¡ç±»å‹**: æ”¯æŒä¼ ç»ŸWebåº”ç”¨åˆ°ç°ä»£å¾®æœåŠ¡
- âœ… **éƒ¨ç½²ç¯å¢ƒ**: é€‚é…å„ç§ç½‘ç»œç¯å¢ƒ
- âœ… **æµè§ˆå™¨å…¼å®¹**: å…¼å®¹ä¸»æµæµè§ˆå™¨

## ğŸ”§ ä½¿ç”¨æŒ‡å—

### åŸºç¡€ä½¿ç”¨
```javascript
import { checkEnvironmentStatusWithProxy } from './utils/proxyStatusCheck';

const result = await checkEnvironmentStatusWithProxy(environment);
console.log(result.status, result.method, result.responseTime);
```

### æ‰¹é‡æ£€æµ‹
```javascript
import { checkMultipleEnvironmentsWithProxy } from './utils/proxyStatusCheck';

const results = await checkMultipleEnvironmentsWithProxy(environments, (progress) => {
  console.log(`æ£€æµ‹è¿›åº¦: ${progress.percentage}%`);
});
```

### é…ç½®è‡ªå®šä¹‰
```javascript
import { saveCheckConfig } from './utils/proxyStatusCheck';

saveCheckConfig({
  timeout: 15000,
  healthPaths: ['/custom-health', '/api/status']
});
```

## ğŸ“ˆ æœªæ¥æ‰©å±•

### è®¡åˆ’åŠŸèƒ½
- [ ] **ä»£ç†æœåŠ¡å™¨æ”¯æŒ**: å¯é€‰çš„æœåŠ¡å™¨ç«¯ä»£ç†
- [ ] **ç¼“å­˜ä¼˜åŒ–**: æ™ºèƒ½ç¼“å­˜ç­–ç•¥
- [ ] **ç›‘æ§å‘Šè­¦**: çŠ¶æ€å˜åŒ–é€šçŸ¥
- [ ] **æ€§èƒ½åˆ†æ**: æ£€æµ‹æ€§èƒ½ç»Ÿè®¡

### æŠ€æœ¯æ¼”è¿›
- [ ] **Service Worker**: åˆ©ç”¨SWè¿›è¡Œåå°æ£€æµ‹
- [ ] **WebRTC**: æ¢ç´¢P2Pè¿é€šæ€§æ£€æµ‹
- [ ] **HTTP/3**: æ”¯æŒæ–°åè®®ç‰¹æ€§
