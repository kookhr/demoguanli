# 环境状态检测功能说明

## 🚀 功能概述

环境管理系统具备简化的网络可用性检测功能，通过实际网络请求来检测环境的可用性，提供快速、准确的状态判断。

## ✨ 主要特性

### 1. 简化检测策略
- **主要方法**: 使用 `fetch` API 发送 HEAD/GET 请求
- **备用方法**: 当遇到 CORS 问题时，使用 `no-cors` 模式
- **快速响应**: 统一5秒超时，快速获得结果

### 2. 简化状态识别
- **可用 (available)**: 网络可直接访问
- **不可达 (unreachable)**: 网络不可访问，可能需要VPN或代理
- **未知 (unknown)**: 状态未知或检测失败

### 3. 性能优化
- **缓存机制**: 30秒内的检测结果会被缓存
- **并发控制**: 批量检测时限制最大并发数为4
- **超时控制**: 统一5秒超时时间
- **进度显示**: 批量检测时显示实时进度

### 4. 用户体验
- **自动检测**: 页面加载时自动进行后台检测
- **手动刷新**: 支持单个环境或批量刷新
- **实时更新**: 状态变化立即反映在界面上
- **详细信息**: 显示检测时间和错误信息

## 🛠 技术实现

### 检测流程
```javascript
1. 检查缓存 → 2. 发送 HEAD/GET 请求 → 3. 处理响应
                     ↓ (网络错误)
4. 使用 no-cors 模式 → 5. 返回结果
```

### 状态映射
```javascript
const statusMapping = {
  'available': '🟢 网络可直接访问',
  'unreachable': '🔴 网络不可访问，可能需要VPN或代理',
  'unknown': '❓ 状态未知或检测失败'
};
```

## 📊 测试环境

为了演示不同的状态检测效果，系统预置了以下测试环境：

1. **Google 搜索** - 测试正常在线状态
2. **GitHub** - 测试正常在线状态  
3. **本地开发服务器** - 测试内网环境
4. **不存在的服务** - 测试离线状态
5. **超时测试服务** - 测试超时状态
6. **错误测试服务** - 测试错误状态

## 🎯 使用方法

### 自动检测
- 页面加载时自动进行后台检测
- 检测结果会缓存30秒，避免频繁请求

### 手动检测
- **单个环境**: 点击环境卡片上的"检测"按钮
- **批量检测**: 点击页面顶部的"检测所有"按钮

### 查看详情
- 状态指示器显示当前状态和描述
- 鼠标悬停查看详细信息
- 检测时间和错误信息实时显示

## ⚙️ 配置选项

### 检测参数
```javascript
const options = {
  useCache: true,        // 是否使用缓存
  timeout: 8000,         // 超时时间(毫秒)
  maxConcurrent: 3       // 最大并发数
};
```

### 缓存设置
```javascript
const CACHE_DURATION = 30000; // 缓存时间30秒
```

## 🔧 自定义配置

### 添加新环境
1. 进入配置管理页面
2. 点击"添加环境"
3. 填写环境信息，确保URL正确
4. 保存后系统会自动检测状态

### 调整检测参数
修改 `src/utils/simpleNetworkCheck.js` 中的相关参数：
- 调整超时时间（默认5秒）
- 修改缓存时长（默认30秒）
- 更改并发数限制（默认4个）

## 🚨 注意事项

### CORS 限制
- 某些网站可能阻止跨域请求
- 系统会自动使用 no-cors 模式作为备用方案
- 简化的检测策略专注于连通性而非详细状态

### 网络环境
- 所有环境都会进行统一的状态检测
- 网络类型标签仅用于分类和视觉识别
- 不区分内网外网的检测限制

### 性能考虑
- 避免频繁手动刷新（有30秒缓存）
- 大量环境时检测采用并发控制
- 统一5秒超时确保快速响应

## 📈 未来优化

- [ ] 支持自定义检测间隔
- [ ] 添加健康检查端点
- [ ] 支持认证环境检测
- [ ] 添加历史状态记录
- [ ] 支持告警通知功能
