# ç¼“å­˜ç®¡ç†å’Œå¿«é€Ÿæ›´æ–°æŒ‡å—

## ğŸš€ **å¿«é€Ÿæ›´æ–°ç¼“å­˜çš„æ–¹æ³•**

### **æ–¹æ³•1ï¼šä½¿ç”¨å¿«é€Ÿéƒ¨ç½²è„šæœ¬ (æ¨è)**

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œ
./scripts/quick-deploy.sh
```

**è„šæœ¬åŠŸèƒ½**:
- âœ… è‡ªåŠ¨æ›´æ–°ç‰ˆæœ¬å· (2.1.0 â†’ 2.1.1)
- âœ… æ›´æ–°æ„å»ºæ—¶é—´æˆ³
- âœ… é‡æ–°æ„å»ºé¡¹ç›®
- âœ… æ¨é€åˆ° Git ä»“åº“
- âœ… è§¦å‘ Cloudflare Pages è‡ªåŠ¨éƒ¨ç½²
- âœ… å°è¯•è‡ªåŠ¨æ¸…é™¤ç¼“å­˜

### **æ–¹æ³•2ï¼šæ‰‹åŠ¨ç‰ˆæœ¬æ›´æ–°**

1. **æ›´æ–°ç‰ˆæœ¬å·**
```bash
# ç¼–è¾‘ wrangler.toml
APP_VERSION = "2.1.1"  # å¢åŠ ç‰ˆæœ¬å·
BUILD_TIME = "2025-01-15T18:45:00Z"  # æ›´æ–°æ—¶é—´
```

2. **é‡æ–°æ„å»ºå’Œéƒ¨ç½²**
```bash
npm run build
git add .
git commit -m "ğŸš€ ç‰ˆæœ¬æ›´æ–° v2.1.1"
git push origin workers
```

### **æ–¹æ³•3ï¼šä½¿ç”¨ç¼“å­˜ç®¡ç†é¢æ¿**

åœ¨ç³»ç»Ÿç®¡ç†é¡µé¢ä¸­æ·»åŠ ç¼“å­˜ç®¡ç†ç»„ä»¶ï¼š

```jsx
import CacheManager from './components/CacheManager';

// åœ¨ç®¡ç†é¡µé¢ä¸­ä½¿ç”¨
<CacheManager />
```

**åŠŸèƒ½ç‰¹æ€§**:
- ğŸ” æŸ¥çœ‹å½“å‰ç‰ˆæœ¬å’Œç¼“å­˜çŠ¶æ€
- ğŸ—‘ï¸ ä¸€é”®æ¸…é™¤æ‰€æœ‰ç¼“å­˜
- âš¡ å¯ç”¨å¼ºåˆ¶åˆ·æ–°æ¨¡å¼
- ğŸ”„ æ£€æŸ¥ç‰ˆæœ¬æ›´æ–°

### **æ–¹æ³•4ï¼šAPI ç›´æ¥è°ƒç”¨**

```javascript
// æ¸…é™¤æ‰€æœ‰ç¼“å­˜
const clearCache = async () => {
  const response = await fetch('/api/cache/clear', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${adminToken}`
    }
  });
  
  if (response.ok) {
    window.location.reload();
  }
};

// å¯ç”¨å¼ºåˆ¶åˆ·æ–°
const forceRefresh = async () => {
  await fetch('/api/cache/force-refresh', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${adminToken}`
    }
  });
};
```

## ğŸ”§ **ç¼“å­˜æœºåˆ¶è¯´æ˜**

### **ç¼“å­˜å±‚çº§**

1. **æµè§ˆå™¨ç¼“å­˜** (å®¢æˆ·ç«¯)
   - é™æ€èµ„æº: 7å¤©
   - HTMLæ–‡ä»¶: 1å°æ—¶
   - APIå“åº”: 5åˆ†é’Ÿ

2. **Cloudflare Edgeç¼“å­˜** (CDN)
   - é™æ€èµ„æº: 7å¤©
   - åŠ¨æ€å†…å®¹: æ ¹æ® Cache-Control å¤´

3. **KVå­˜å‚¨ç¼“å­˜** (åç«¯)
   - é…ç½®æ•°æ®: 1å°æ—¶
   - ç”¨æˆ·æ•°æ®: å®æ—¶æ›´æ–°

### **ç‰ˆæœ¬æ§åˆ¶æœºåˆ¶**

```javascript
// å“åº”å¤´ä¸­åŒ…å«ç‰ˆæœ¬ä¿¡æ¯
X-App-Version: 2.1.0
X-Build-Time: 2025-01-15T18:30:00Z
X-Force-Refresh: false
```

**ç‰ˆæœ¬æ£€æŸ¥é€»è¾‘**:
- å‰ç«¯å®šæœŸæ£€æŸ¥æœåŠ¡å™¨ç‰ˆæœ¬
- ç‰ˆæœ¬ä¸åŒ¹é…æ—¶æç¤ºç”¨æˆ·æ›´æ–°
- æ”¯æŒå¼ºåˆ¶åˆ·æ–°æ¨¡å¼

## âš¡ **ç«‹å³ç”Ÿæ•ˆçš„è§£å†³æ–¹æ¡ˆ**

### **ç´§æ€¥æ›´æ–°æµç¨‹**

1. **ç«‹å³æ¸…é™¤ç¼“å­˜**
```bash
# ä½¿ç”¨å¿«é€Ÿéƒ¨ç½²è„šæœ¬
./scripts/quick-deploy.sh

# æˆ–æ‰‹åŠ¨æ‰§è¡Œ
curl -X POST "https://your-domain.com/api/cache/clear" \
  -H "Authorization: Bearer YOUR_ADMIN_TOKEN"
```

2. **å¯ç”¨å¼ºåˆ¶åˆ·æ–°æ¨¡å¼**
```bash
curl -X POST "https://your-domain.com/api/cache/force-refresh" \
  -H "Authorization: Bearer YOUR_ADMIN_TOKEN"
```

3. **é€šçŸ¥ç”¨æˆ·åˆ·æ–°**
```javascript
// åœ¨å‰ç«¯æ˜¾ç¤ºæ›´æ–°é€šçŸ¥
if (serverVersion !== clientVersion) {
  showUpdateNotification();
}
```

### **Cloudflare ç‰¹å®šæ“ä½œ**

1. **æ¸…é™¤ Cloudflare ç¼“å­˜**
   - ç™»å½• Cloudflare Dashboard
   - è¿›å…¥ Pages é¡¹ç›®
   - ç‚¹å‡» "Purge Cache" â†’ "Purge Everything"

2. **å¼ºåˆ¶é‡æ–°éƒ¨ç½²**
   - åœ¨ Pages é¡¹ç›®ä¸­ç‚¹å‡» "Retry deployment"
   - æˆ–æ¨é€æ–°çš„ commit è§¦å‘è‡ªåŠ¨éƒ¨ç½²

## ğŸ“Š **ç¼“å­˜çŠ¶æ€ç›‘æ§**

### **å®æ—¶ç›‘æ§æŒ‡æ ‡**

```javascript
// ç¼“å­˜çŠ¶æ€æ£€æŸ¥
const cacheStatus = {
  version: "2.1.0",
  buildTime: "2025-01-15T18:30:00Z",
  forceRefresh: {
    active: false,
    until: null
  },
  cacheConfig: {
    staticAssets: 604800,  // 7å¤©
    apiResponses: 300,     // 5åˆ†é’Ÿ
    healthCheck: 60,       // 1åˆ†é’Ÿ
    kvCache: 36000         // 1å°æ—¶
  }
};
```

### **æ€§èƒ½æŒ‡æ ‡**

- **ç¼“å­˜å‘½ä¸­ç‡**: ç›®æ ‡ >90%
- **æ›´æ–°å»¶è¿Ÿ**: <5åˆ†é’Ÿ
- **ç”¨æˆ·æ„ŸçŸ¥å»¶è¿Ÿ**: <30ç§’

## ğŸ›  **æ•…éšœæ’é™¤**

### **å¸¸è§é—®é¢˜**

1. **æ›´æ–°ä¸ç”Ÿæ•ˆ**
   ```bash
   # æ£€æŸ¥ç‰ˆæœ¬å·æ˜¯å¦æ›´æ–°
   curl -I https://your-domain.com/api/info
   
   # æ¸…é™¤æœ¬åœ°ç¼“å­˜
   localStorage.clear();
   sessionStorage.clear();
   
   # ç¡¬åˆ·æ–°æµè§ˆå™¨
   Ctrl + Shift + R (Windows/Linux)
   Cmd + Shift + R (Mac)
   ```

2. **éƒ¨åˆ†ç”¨æˆ·çœ‹åˆ°æ—§ç‰ˆæœ¬**
   ```bash
   # å¯ç”¨å¼ºåˆ¶åˆ·æ–°æ¨¡å¼
   curl -X POST "https://your-domain.com/api/cache/force-refresh"
   
   # æ¸…é™¤ CDN ç¼“å­˜
   # åœ¨ Cloudflare Dashboard ä¸­æ“ä½œ
   ```

3. **API å“åº”ç¼“å­˜é—®é¢˜**
   ```javascript
   // æ·»åŠ ç¼“å­˜ç ´åå‚æ•°
   fetch(`/api/environments?v=${Date.now()}`);
   
   // æˆ–è®¾ç½® no-cache å¤´
   fetch('/api/environments', {
     headers: { 'Cache-Control': 'no-cache' }
   });
   ```

### **è°ƒè¯•å·¥å…·**

1. **æµè§ˆå™¨å¼€å‘è€…å·¥å…·**
   - Network æ ‡ç­¾æŸ¥çœ‹ç¼“å­˜çŠ¶æ€
   - Application æ ‡ç­¾æ¸…é™¤æœ¬åœ°å­˜å‚¨
   - Console æ£€æŸ¥ç‰ˆæœ¬ä¿¡æ¯

2. **ç¼“å­˜æ£€æŸ¥å‘½ä»¤**
   ```bash
   # æ£€æŸ¥å“åº”å¤´
   curl -I https://your-domain.com/
   
   # æ£€æŸ¥ API ç‰ˆæœ¬
   curl https://your-domain.com/api/info
   
   # æ£€æŸ¥ç¼“å­˜çŠ¶æ€
   curl https://your-domain.com/api/cache/status
   ```

## ğŸ“‹ **æœ€ä½³å®è·µ**

### **éƒ¨ç½²æµç¨‹**

1. **å¼€å‘é˜¶æ®µ**
   - ä½¿ç”¨ `FORCE_REFRESH=true` ç¦ç”¨ç¼“å­˜
   - é¢‘ç¹æµ‹è¯•ç¼“å­˜æ¸…é™¤åŠŸèƒ½

2. **æµ‹è¯•é˜¶æ®µ**
   - éªŒè¯ç‰ˆæœ¬æ§åˆ¶æœºåˆ¶
   - æµ‹è¯•ç¼“å­˜æ¸…é™¤ API

3. **ç”Ÿäº§éƒ¨ç½²**
   - ä½¿ç”¨å¿«é€Ÿéƒ¨ç½²è„šæœ¬
   - ç›‘æ§ç¼“å­˜çŠ¶æ€
   - å‡†å¤‡å›æ»šæ–¹æ¡ˆ

### **ç¼“å­˜ç­–ç•¥**

1. **é™æ€èµ„æº**: é•¿æœŸç¼“å­˜ + ç‰ˆæœ¬æ§åˆ¶
2. **API å“åº”**: çŸ­æœŸç¼“å­˜ + å®æ—¶æ›´æ–°
3. **HTML æ–‡ä»¶**: ä¸­æœŸç¼“å­˜ + ç‰ˆæœ¬æ£€æŸ¥

### **ç”¨æˆ·ä½“éªŒ**

1. **æ¸è¿›å¼æ›´æ–°**: ä¸å¼ºåˆ¶ç”¨æˆ·ç«‹å³åˆ·æ–°
2. **æ›´æ–°é€šçŸ¥**: å‹å¥½çš„æ›´æ–°æç¤º
3. **åå°æ›´æ–°**: é¢„åŠ è½½æ–°ç‰ˆæœ¬èµ„æº

## ğŸš€ **å¿«é€Ÿä¸Šçº¿æ£€æŸ¥æ¸…å•**

- [ ] æ›´æ–°ç‰ˆæœ¬å·
- [ ] é‡æ–°æ„å»ºé¡¹ç›®
- [ ] æ¨é€åˆ° Git ä»“åº“
- [ ] ç­‰å¾…è‡ªåŠ¨éƒ¨ç½²å®Œæˆ
- [ ] æ¸…é™¤ Cloudflare ç¼“å­˜
- [ ] å¯ç”¨å¼ºåˆ¶åˆ·æ–°æ¨¡å¼
- [ ] éªŒè¯æ›´æ–°ç”Ÿæ•ˆ
- [ ] é€šçŸ¥ç”¨æˆ·åˆ·æ–°

**é¢„è®¡æ€»æ—¶é—´**: 3-5åˆ†é’Ÿ

ä½¿ç”¨è¿™äº›æ–¹æ³•ï¼Œæ‚¨å¯ä»¥åœ¨å‡ åˆ†é’Ÿå†…è®©æ‰€æœ‰ç”¨æˆ·çœ‹åˆ°æœ€æ–°ç‰ˆæœ¬ï¼
