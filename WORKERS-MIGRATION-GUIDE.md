# ğŸš€ Cloudflare Pages åˆ° Workers è¿ç§»æŒ‡å—

åŸºäº2025å¹´æœ€æ–°æŠ€æœ¯å’ŒGitHubé›†æˆçš„å®Œæ•´è¿ç§»æ–¹æ¡ˆ

## ğŸ“‹ ç›®å½•

- [è¿ç§»æ¦‚è¿°](#è¿ç§»æ¦‚è¿°)
- [æŠ€æœ¯ä¼˜åŠ¿](#æŠ€æœ¯ä¼˜åŠ¿)
- [è¿ç§»æ­¥éª¤](#è¿ç§»æ­¥éª¤)
- [GitHubé›†æˆ](#githubé›†æˆ)
- [éƒ¨ç½²éªŒè¯](#éƒ¨ç½²éªŒè¯)
- [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)

## ğŸ¯ è¿ç§»æ¦‚è¿°

### è¿ç§»å‰åå¯¹æ¯”

| ç‰¹æ€§ | Cloudflare Pages | Cloudflare Workers |
|------|------------------|-------------------|
| **é™æ€èµ„æº** | åŸç”Ÿæ”¯æŒ | Static Assets (2025æ–°ç‰¹æ€§) |
| **APIå¤„ç†** | Pages Functions | Worker åŸç”Ÿæ”¯æŒ |
| **æ€§èƒ½** | è¾¹ç¼˜ç¼“å­˜ | é›¶å†·å¯åŠ¨ + æ™ºèƒ½æ”¾ç½® |
| **CI/CD** | Gité›†æˆ | Workers Builds + GitHub Actions |
| **é…ç½®** | ç®€å• | æ›´çµæ´»å¼ºå¤§ |
| **æ‰©å±•æ€§** | æœ‰é™ | æ— é™åˆ¶ |

### ä¸»è¦æ”¹è¿›

- âœ… **é›¶å†·å¯åŠ¨æ—¶é—´** - Workers æ— å†·å¯åŠ¨å»¶è¿Ÿ
- âœ… **æ™ºèƒ½æ”¾ç½®** - è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜æ‰§è¡Œä½ç½®
- âœ… **æ›´å¼ºå¤§çš„API** - å®Œæ•´çš„Workers Runtime API
- âœ… **æ›´å¥½çš„CI/CD** - GitHub Actions + Workers Builds
- âœ… **æ›´çµæ´»çš„é…ç½®** - å¤šç¯å¢ƒæ”¯æŒ
- âœ… **æ›´å¥½çš„ç›‘æ§** - è¯¦ç»†çš„åˆ†æå’Œæ—¥å¿—

## ğŸ”§ æŠ€æœ¯ä¼˜åŠ¿

### 2025å¹´æœ€æ–°Workersç‰¹æ€§

1. **Static Assets ç»‘å®š**
   ```toml
   [assets]
   directory = "./dist"
   binding = "ASSETS"
   not_found_handling = "single-page-application"
   ```

2. **æ™ºèƒ½æ”¾ç½®**
   ```toml
   [placement]
   mode = "smart"
   ```

3. **WorkerEntrypoint ç±»**
   ```javascript
   export default class extends WorkerEntrypoint {
     async fetch(request, env, ctx) {
       // å¤„ç†é€»è¾‘
     }
   }
   ```

4. **å¢å¼ºçš„è§‚å¯Ÿæ€§**
   ```toml
   [observability]
   enabled = true
   ```

## ğŸš€ è¿ç§»æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šè‡ªåŠ¨è¿ç§»

```bash
# è¿è¡Œè‡ªåŠ¨è¿ç§»è„šæœ¬
npm run migrate:pages-to-workers
```

è¿ç§»è„šæœ¬å°†è‡ªåŠ¨å®Œæˆï¼š
- âœ… ç¯å¢ƒæ£€æŸ¥å’Œä¾èµ–éªŒè¯
- âœ… ç°æœ‰é…ç½®å¤‡ä»½
- âœ… Pages Functions è½¬æ¢
- âœ… Wrangler é…ç½®ç”Ÿæˆ
- âœ… KV å‘½åç©ºé—´åˆ›å»º
- âœ… é¡¹ç›®æ„å»ºæµ‹è¯•

### ç¬¬äºŒæ­¥ï¼šéªŒè¯é…ç½®

```bash
# éªŒè¯è¿ç§»ç»“æœ
npm run validate:workers
```

éªŒè¯å†…å®¹åŒ…æ‹¬ï¼š
- ğŸ“ å¿…è¦æ–‡ä»¶å­˜åœ¨æ€§
- âš™ï¸ Wrangler é…ç½®æ­£ç¡®æ€§
- ğŸ” Worker è„šæœ¬è¯­æ³•
- ğŸ“¦ Package.json é…ç½®
- ğŸ”— GitHub Actions å·¥ä½œæµ
- ğŸ”¨ æ„å»ºè¾“å‡ºå®Œæ•´æ€§

### ç¬¬ä¸‰æ­¥ï¼šæœ¬åœ°æµ‹è¯•

```bash
# æœ¬åœ°å¼€å‘æœåŠ¡å™¨
npm run workers:dev
```

æµ‹è¯•åŠŸèƒ½ï¼š
- ğŸŒ é™æ€èµ„æºè®¿é—®
- ğŸ”Œ API ç«¯ç‚¹åŠŸèƒ½
- ğŸ’¾ KV å­˜å‚¨æ“ä½œ
- ğŸ¨ å‰ç«¯ç•Œé¢äº¤äº’

### ç¬¬å››æ­¥ï¼šéƒ¨ç½²æµ‹è¯•

```bash
# éƒ¨ç½²åˆ°å¼€å‘ç¯å¢ƒ
npm run workers:deploy

# éƒ¨ç½²åˆ°é¢„ç”Ÿäº§ç¯å¢ƒ
npm run workers:deploy:staging

# éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
npm run workers:deploy:production
```

## ğŸ”— GitHubé›†æˆ

### è®¾ç½®GitHub Secrets

åœ¨GitHubä»“åº“è®¾ç½®ä¸­æ·»åŠ ï¼š

1. **CLOUDFLARE_API_TOKEN**
   - åœ¨Cloudflare Dashboardåˆ›å»ºAPI Token
   - æƒé™ï¼š`Zone:Zone:Read`, `Account:Cloudflare Workers:Edit`

2. **CLOUDFLARE_ACCOUNT_ID**
   - åœ¨Cloudflare Dashboardå³ä¾§æ æ‰¾åˆ°Account ID

### è‡ªåŠ¨åŒ–å·¥ä½œæµ

æ¨é€ä»£ç åˆ°ä¸åŒåˆ†æ”¯è§¦å‘ä¸åŒéƒ¨ç½²ï¼š

```
develop åˆ†æ”¯ â†’ å¼€å‘ç¯å¢ƒéƒ¨ç½²
main åˆ†æ”¯ â†’ é¢„ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
main åˆ†æ”¯ + æ‰‹åŠ¨æ‰¹å‡† â†’ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
Pull Request â†’ é¢„è§ˆéƒ¨ç½²
```

### Workers Buildsé›†æˆ

1. åœ¨Cloudflare Dashboardè¿›å…¥Workers & Pages
2. é€‰æ‹©"Connect to Git"
3. è¿æ¥GitHubä»“åº“
4. é…ç½®æ„å»ºè®¾ç½®ï¼š
   ```
   Build command: npm run build
   Build output directory: dist
   Root directory: /
   ```

## âœ… éƒ¨ç½²éªŒè¯

### åŠŸèƒ½æ£€æŸ¥æ¸…å•

éƒ¨ç½²å®ŒæˆåéªŒè¯ä»¥ä¸‹åŠŸèƒ½ï¼š

- [ ] **é™æ€èµ„æºåŠ è½½**
  - è®¿é—®Worker URL
  - æ£€æŸ¥CSS/JSèµ„æºåŠ è½½
  - éªŒè¯å›¾ç‰‡å’Œå­—ä½“æ–‡ä»¶

- [ ] **APIåŠŸèƒ½æµ‹è¯•**
  - è®¿é—® `/api/health` å¥åº·æ£€æŸ¥
  - æµ‹è¯• `/api/kv?action=test` KVè¿æ¥
  - éªŒè¯ç¯å¢ƒç®¡ç†åŠŸèƒ½

- [ ] **SPAè·¯ç”±**
  - ç›´æ¥è®¿é—®å­è·¯å¾„
  - åˆ·æ–°é¡µé¢æ­£å¸¸æ˜¾ç¤º
  - æµè§ˆå™¨å‰è¿›åé€€åŠŸèƒ½

- [ ] **è·¨åŸŸè¯·æ±‚**
  - APIè¯·æ±‚æ­£å¸¸å“åº”
  - CORSå¤´é…ç½®æ­£ç¡®
  - æ— æ§åˆ¶å°é”™è¯¯

### æ€§èƒ½éªŒè¯

```bash
# æŸ¥çœ‹Workeræ—¥å¿—
npm run workers:tail

# æ£€æŸ¥å“åº”æ—¶é—´
curl -w "@curl-format.txt" -o /dev/null -s "https://your-worker.workers.dev/api/health"
```

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**1. é™æ€èµ„æº404é”™è¯¯**
```
åŸå› ï¼šAssetsç»‘å®šé…ç½®é”™è¯¯
è§£å†³ï¼šæ£€æŸ¥wrangler.tomlä¸­çš„[assets]é…ç½®
```

**2. KVç»‘å®šé”™è¯¯**
```
åŸå› ï¼šKVå‘½åç©ºé—´IDæœªæ­£ç¡®é…ç½®
è§£å†³ï¼šè¿è¡Œ wrangler kv:namespace create ENV_CONFIG
```

**3. CORSé”™è¯¯**
```
åŸå› ï¼šWorkerä¸­CORSå¤´é…ç½®ç¼ºå¤±
è§£å†³ï¼šæ£€æŸ¥getCorsHeaders()æ–¹æ³•å®ç°
```

**4. GitHub Actionså¤±è´¥**
```
åŸå› ï¼šSecretsé…ç½®é”™è¯¯æˆ–æƒé™ä¸è¶³
è§£å†³ï¼šéªŒè¯CLOUDFLARE_API_TOKENå’ŒCLOUDFLARE_ACCOUNT_ID
```

### è°ƒè¯•æŠ€å·§

**æŸ¥çœ‹å®æ—¶æ—¥å¿—ï¼š**
```bash
wrangler tail --format pretty
```

**æœ¬åœ°è°ƒè¯•ï¼š**
```bash
wrangler dev --local --port 8787
```

**é…ç½®éªŒè¯ï¼š**
```bash
wrangler whoami
wrangler kv:namespace list
```

## ğŸ“Š ç›‘æ§å’Œåˆ†æ

### Cloudflare Analytics

åœ¨Cloudflare DashboardæŸ¥çœ‹ï¼š
- è¯·æ±‚é‡å’Œå“åº”æ—¶é—´
- é”™è¯¯ç‡å’ŒçŠ¶æ€ç åˆ†å¸ƒ
- åœ°ç†ä½ç½®åˆ†å¸ƒ
- ç¼“å­˜å‘½ä¸­ç‡

### è‡ªå®šä¹‰ç›‘æ§

åœ¨Workerä¸­æ·»åŠ ç›‘æ§ä»£ç ï¼š
```javascript
// è®°å½•æ€§èƒ½æŒ‡æ ‡
const start = Date.now();
// ... å¤„ç†é€»è¾‘
const duration = Date.now() - start;
console.log(`Request processed in ${duration}ms`);
```

## ğŸ¯ æœ€ä½³å®è·µ

### 1. ç¯å¢ƒç®¡ç†
- ä½¿ç”¨ä¸åŒçš„Workeråç§°åŒºåˆ†ç¯å¢ƒ
- é…ç½®ç¯å¢ƒç‰¹å®šçš„å˜é‡
- å®æ–½æ¸è¿›å¼éƒ¨ç½²ç­–ç•¥

### 2. æ€§èƒ½ä¼˜åŒ–
- å¯ç”¨æ™ºèƒ½æ”¾ç½®
- åˆç†é…ç½®ç¼“å­˜ç­–ç•¥
- ä¼˜åŒ–é™æ€èµ„æºå¤§å°

### 3. å®‰å…¨è€ƒè™‘
- é™åˆ¶APIè®¿é—®é¢‘ç‡
- éªŒè¯è¾“å…¥å‚æ•°
- ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨æ•æ„Ÿä¿¡æ¯

### 4. ä»£ç è´¨é‡
- å®æ–½ä»£ç å®¡æŸ¥
- æ·»åŠ å•å…ƒæµ‹è¯•
- ä½¿ç”¨TypeScriptï¼ˆå¯é€‰ï¼‰

## ğŸ”„ å›æ»šç­–ç•¥

å¦‚éœ€å›æ»šåˆ°Pagesï¼š

1. **ä¿ç•™å¤‡ä»½**
   ```bash
   # è¿ç§»è„šæœ¬ä¼šè‡ªåŠ¨åˆ›å»ºå¤‡ä»½ç›®å½•
   ls backup-*
   ```

2. **æ¢å¤é…ç½®**
   ```bash
   # ä»å¤‡ä»½æ¢å¤åŸå§‹æ–‡ä»¶
   cp backup-*/package.json ./
   cp backup-*/vite.config.js ./
   ```

3. **é‡æ–°éƒ¨ç½²Pages**
   - åœ¨Cloudflare Dashboardé‡æ–°åˆ›å»ºPagesé¡¹ç›®
   - è¿æ¥GitHubä»“åº“
   - é…ç½®æ„å»ºè®¾ç½®

## ğŸ“ è·å–å¸®åŠ©

é‡åˆ°é—®é¢˜æ—¶ï¼š

1. æŸ¥çœ‹è¿ç§»æŠ¥å‘Šï¼š`MIGRATION_REPORT.md`
2. è¿è¡Œé…ç½®éªŒè¯ï¼š`npm run validate:workers`
3. æŸ¥çœ‹Cloudflare Workersæ–‡æ¡£
4. æ£€æŸ¥GitHub Actionsæ—¥å¿—
5. åœ¨é¡¹ç›®Issuesä¸­æé—®

## ğŸ“‹ è¿ç§»æ£€æŸ¥æ¸…å•

å®Œæˆè¿ç§»å‰è¯·ç¡®è®¤ï¼š

- [ ] è¿è¡Œè‡ªåŠ¨è¿ç§»è„šæœ¬æˆåŠŸ
- [ ] é…ç½®éªŒè¯å…¨éƒ¨é€šè¿‡
- [ ] æœ¬åœ°æµ‹è¯•åŠŸèƒ½æ­£å¸¸
- [ ] KVå‘½åç©ºé—´åˆ›å»ºæˆåŠŸ
- [ ] GitHub Secretsé…ç½®å®Œæˆ
- [ ] éƒ¨ç½²åˆ°å„ç¯å¢ƒæˆåŠŸ
- [ ] åŠŸèƒ½éªŒè¯æ¸…å•å®Œæˆ
- [ ] æ€§èƒ½æµ‹è¯•é€šè¿‡
- [ ] ç›‘æ§é…ç½®å°±ç»ª

## ğŸ‰ è¿ç§»å®Œæˆ

æ­å–œï¼æ‚¨å·²æˆåŠŸå°†ç¯å¢ƒç®¡ç†ç³»ç»Ÿä»Cloudflare Pagesè¿ç§»åˆ°Workersã€‚

**ç«‹å³å¯ç”¨çš„åŠŸèƒ½ï¼š**
- âš¡ é›¶å†·å¯åŠ¨çš„Workersæ€§èƒ½
- ğŸŒ å…¨çƒè¾¹ç¼˜ç½‘ç»œéƒ¨ç½²
- ğŸ”„ GitHubè‡ªåŠ¨åŒ–CI/CD
- ğŸ“Š å®æ—¶ç›‘æ§å’Œæ—¥å¿—
- ğŸ¯ æ™ºèƒ½æ”¾ç½®ä¼˜åŒ–

**ä¸‹ä¸€æ­¥å»ºè®®ï¼š**
- ğŸ”— é…ç½®è‡ªå®šä¹‰åŸŸå
- ğŸ“Š è®¾ç½®ç›‘æ§å‘Šè­¦
- ğŸš€ æ¢ç´¢æ›´å¤šWorkersåŠŸèƒ½
- ğŸ“ˆ ä¼˜åŒ–æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒ
- ğŸ”’ å®æ–½å®‰å…¨æœ€ä½³å®è·µ

**é‡è¦æé†’ï¼š**
ç¡®è®¤æ–°Workersç¯å¢ƒç¨³å®šè¿è¡Œåï¼Œå¯ä»¥å®‰å…¨åˆ é™¤åŸæœ‰çš„Pagesé¡¹ç›®ã€‚
